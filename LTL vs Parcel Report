//created by Omar Alladina\\
/*
*****STEPS*******
1. Log into Magento
2. Navigate to sales_order_items
3. Choose the appropriate date - typically previous day - changer the dealer filter to "All Sales Reps"
4. Export as CSV
5. Upload to OWS folder
6. Open in Sheets
7. Copy Spreadsheet Link
8. Paste Link to csv_rows (row18), csv_ss (row32)
9. Save
10. Press Play for each function starting from the top
*/

//this function will insert the accurate number of rows on the LTL file based on the row count found in the newest CSV file

function csvMenu () {

var ui = SpreadsheetApp.getUi();
ui.createMenu("Quota Update").addItem("Insert rows", "insertRows").addSeparator().addItem("Copy and paste", "copyPaste").addSeparator().addItem("Copy to rep sheets", "ltlParcUpdate").addToUi();

}

function insertRows() {

var ui = SpreadsheetApp.getUi();
var url_prompt = ui.prompt('Please enter the URL for the recent Magento Export - make sure to put the URL in double quotes "www.google.com"', ui.ButtonSet.OK);
var url_response = url_prompt.getResponseText();



 var csv_rows = SpreadsheetApp.openByUrl(url_response).getActiveSheet().getLastRow()-1;  
 var ltl_ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1RQ4b4Rv4bJiYuHXP6u2uOUXBR3i2OIYlZlZ_wwGDD0I/edit#gid=1562550719");
 var magSheet = ltl_ss.getSheetByName("Magento Export");
 var catForm = magSheet.getRange("G2").getFormula();
 var ltlForm = magSheet.getRange("L2").getFormula();
 
     magSheet.insertRowsBefore(2, csv_rows);
     magSheet.getRange("G2").setFormula(catForm);
     magSheet.getRange("L2").setFormula(ltlForm); 
     
}

//this function will copy the data from the CSV file in chunks and then paste them in chunks to the Magento Export tab on the LTL file
function copyPaste (){

var ui = SpreadsheetApp.getUi();
var url_prompt = ui.prompt('Please enter the URL for the recent Magento Export - make sure to put the URL in double quotes "www.google.com"', ui.ButtonSet.OK);
var url_response = url_prompt.getResponseText();


 var csv_ss = SpreadsheetApp.openByUrl(url_response);
 var copySheet = csv_ss.getActiveSheet().setName("Copy");
 var sheetName = copySheet.getName();
 var ltl_ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1RQ4b4Rv4bJiYuHXP6u2uOUXBR3i2OIYlZlZ_wwGDD0I/edit#gid=1562550719");
 var ltl_magSheet = ltl_ss.getSheetByName("Magento Export");
 var rows = csv_ss.getActiveSheet().getLastRow()-1;
 var mag_rows = ltl_ss.getSheetByName("Magento Export").getLastRow()-1;
 var csv_columns = [[1,6],[7,4],[11,5]];
 var newColumns = [[1,6],[8,4],[13,5]];
 var cat_form = ltl_magSheet.getRange("G2").getFormula();
 var ltl_form = ltl_magSheet.getRange("L2").getFormula();
 

 //copy first 6 columns; paste to column 1 row 2;
    var dataSet1 = csv_ss.getSheetByName(sheetName).getRange(2, csv_columns[0][0], rows, csv_columns[0][1]).getValues();
    ltl_magSheet.getRange(2, newColumns[0][0], rows, newColumns[0][1]).setValues(dataSet1);
 //copy from column 7 row 2; paste to column 8 row 2;
    var dataSet2 = csv_ss.getSheetByName(sheetName).getRange(2, csv_columns[1][0], rows, csv_columns[1][1]).getValues();
    ltl_magSheet.getRange(2, newColumns[1][0], rows, newColumns[1][1]).setValues(dataSet2);
 //columns third copy = 5; paste to column 13 row 2;
    var dataSet3 = csv_ss.getSheetByName(sheetName).getRange(2, csv_columns[2][0], rows, csv_columns[2][1]).getValues();
    ltl_magSheet.getRange(2, newColumns[2][0], rows, newColumns[2][1]).setValues(dataSet3);


    ltl_magSheet.getRange(2, 7, mag_rows, 1).setFormula(cat_form);
    ltl_magSheet.getRange(2, 12, mag_rows, 1).setFormula(ltl_form);


}

//this function will copy the sales data pasted from function copyPaste, iterate through each rep tab and paste the new values 
function ltlParcUpdate() {
  
var ltl_ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1RQ4b4Rv4bJiYuHXP6u2uOUXBR3i2OIYlZlZ_wwGDD0I/edit#gid=1822529590");  
var repNames = ["Josh Haskins","Joe Assencoa","Tim Donegan","Cory Procter","Steve Wyland","Tara Guidry","Vince Pavone","Baker Leavitt","Matt White"];

var magTitle = ltl_ss.getSheetByName("Magento Export").getRange("A1:Q1").getValues();  
    
    for (var x = 0; x < repNames.length; x++) {
  
  var   repSheet = ltl_ss.getSheetByName(repNames[x]);  
  
   repSheet.getRange("E:U").clear();
   repSheet.getRange("E5").setFormula("=filter('Magento Export'!A2:Q6000,'Magento Export'!a2:A6000=a1)");
   repSheet.getRange("E:U").copyValuesToRange(repSheet, 5, 21, 1, 6000);
   repSheet.getRange("e4:u4").setValues(magTitle);
    
    }  
   
  

   

}

